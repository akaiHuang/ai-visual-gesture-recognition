# 測試與監控指南

快速指南：如何測試手勢識別 Demo 並監控效能。

## 🚀 快速開始

### 方法 1: 互動式測試（推薦）

```bash
cd gesture_recognition_demo
./test_monitor.sh
```

這個腳本會引導你選擇：
- **選項 1**: 只運行應用程式（手動測試）
- **選項 2**: 應用程式 + 背景效能監控（推薦）
- **選項 3**: 完整效能基準測試

### 方法 2: 分開窗口監控

**終端機 1**: 實時效能監控
```bash
cd gesture_recognition_demo
python monitor.py
```

**終端機 2**: 運行應用程式
```bash
cd gesture_recognition_demo
python main.py
```

### 方法 3: 效能基準測試

```bash
cd gesture_recognition_demo
python benchmark.py
```

自動測試三個階段：
1. 閒置效能 (10秒)
2. MediaPipe 手部偵測 (15秒)
3. 完整流程（偵測+AI識別）(15秒)

## 📊 測試項目

### 1. 基本功能測試

**目標**: 驗證所有功能正常運作

步驟：
1. 執行 `python verify.py` - 檢查環境
2. 執行 `python main.py` - 啟動應用程式
3. 點擊「開始偵測」
4. 檢查項目：
   - ✓ 攝影機畫面正常顯示
   - ✓ 手部關鍵點正確繪製
   - ✓ 手勢識別結果顯示
   - ✓ 效能面板顯示數據（CPU/記憶體/GPU）

### 2. 效能測試

**目標**: 確認效能符合預期

預期指標：
- **閒置時**: CPU < 10%, 記憶體 < 50 MB
- **偵測時**: CPU < 70%, 記憶體 < 800 MB
- **GPU**: 顯示 Metal 加速狀態

執行：
```bash
# 選項 A: 互動式測試
./test_monitor.sh  # 選擇選項 2

# 選項 B: 基準測試
python benchmark.py
```

### 3. 穩定性測試

**目標**: 長時間運行不崩潰

步驟：
1. 開啟兩個終端機
2. 終端機 1: `python monitor.py`
3. 終端機 2: `python main.py`
4. 運行 5-10 分鐘，觀察：
   - CPU 使用率是否穩定
   - 記憶體是否持續增長（洩漏）
   - GPU 狀態是否正常

### 4. 壓力測試

**目標**: 測試極限情況

方法：
1. 快速移動手部
2. 多次進出畫面
3. 變換不同手勢
4. 觀察效能變化

## 🔍 監控工具說明

### monitor.py - 實時監控

**功能**:
- 每秒更新效能數據
- 進度條視覺化
- 顏色警示（綠/黃/紅）
- 統計數據（平均/最大/最小）

**使用**:
```bash
python monitor.py
# 按 Enter 開始
# Ctrl+C 停止並顯示統計
```

### test_monitor.sh - 整合測試

**功能**:
- 系統驗證
- 背景監控
- 自動記錄日誌
- 統計報告

**日誌位置**: `test_logs/perf_monitor_YYYYMMDD_HHMMSS.log`

### benchmark.py - 基準測試

**功能**:
- 三階段自動測試
- 攝影機實際測試
- FPS 統計
- 完整報告

**注意**: 需要攝影機正常工作

## 📝 測試檢查清單

### 環境檢查
- [ ] Python 3.11+
- [ ] 所有依賴已安裝 (`pip list`)
- [ ] 攝影機可用
- [ ] Metal 加速啟用（macOS）

### 功能檢查
- [ ] 視窗正常顯示
- [ ] 攝影機畫面清晰
- [ ] 手部偵測正常（21 個關鍵點）
- [ ] 手勢識別運作
- [ ] 效能面板更新

### 效能檢查
- [ ] CPU < 70%（偵測時）
- [ ] 記憶體 < 800 MB
- [ ] GPU 顯示 Metal 狀態
- [ ] 無記憶體洩漏
- [ ] 畫面流暢（~30 FPS）

### 使用者體驗
- [ ] 啟動速度快 (< 5秒)
- [ ] 偵測延遲低
- [ ] 手勢識別準確
- [ ] 介面回應靈敏

## 🐛 問題排查

### 問題: MediaPipe 載入慢

**解決**: 首次載入需要 10-15 秒（字體掃描），這是正常的。

### 問題: 攝影機無法開啟

**檢查**:
```bash
# macOS
ls /dev/video*
# 或檢查系統偏好設定 > 安全性與隱私 > 攝影機
```

### 問題: GPU 不顯示

**檢查**:
```bash
python verify.py  # 查看 GPU 偵測狀態
```

如果顯示 "Metal 加速已啟用" 但無 GPU 數據，這是正常的（需要 sudo 權限才能取得完整數據）。

### 問題: 效能不佳

**優化**:
1. 編輯 `config.py`:
   ```python
   CAMERA_WIDTH = 320  # 降低解析度
   CAMERA_HEIGHT = 240
   UI_UPDATE_INTERVAL_MS = 66  # 降低 FPS
   ```

2. 關閉其他應用程式
3. 確認 Metal 加速已啟用

## 📊 效能基準參考

### 測試環境
- macOS 26.1 (Sequoia)
- Apple M1 Max
- 64 GB RAM

### 預期結果

| 階段 | CPU | 記憶體 | GPU |
|------|-----|--------|-----|
| 閒置 | < 5% | < 30 MB | - |
| MediaPipe | 40-60% | 300-500 MB | Metal 加速 |
| 完整流程 | 50-70% | 400-700 MB | Metal 加速 |

### 警告閾值

- 🟢 正常: CPU < 70%, 記憶體 < 800 MB
- 🟡 警告: CPU 70-100%, 記憶體 800-1200 MB
- 🔴 危險: CPU > 100%, 記憶體 > 1200 MB

## 💡 測試技巧

1. **先執行 verify.py**: 確保環境正確
2. **使用背景監控**: 不影響應用程式效能
3. **記錄日誌**: 方便事後分析
4. **多次測試**: 取平均值更準確
5. **觀察趨勢**: 注意記憶體是否持續增長

## 🎯 測試建議流程

```bash
# 1. 驗證環境
python verify.py

# 2. 快速功能測試
python main.py  # 手動測試 2-3 分鐘

# 3. 效能基準測試
python benchmark.py

# 4. 長時間監控（可選）
./test_monitor.sh  # 選擇選項 2，運行 10+ 分鐘
```

## 📁 測試輸出

測試會產生以下檔案：
- `test_logs/perf_monitor_*.log` - 背景監控日誌
- 終端機輸出 - 即時統計數據

建議保存這些檔案以便後續分析和對比。
